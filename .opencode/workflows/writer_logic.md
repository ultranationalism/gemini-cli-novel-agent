# 小说创作工作流

## 核心循环

**构思 → 检索/回顾 → 写作 → 记忆 → 修正**

这是贯穿整个创作过程的基本循环。每个循环都要确保质量和连贯性。

---

## 阶段一：大纲与架构

### 1. 需求获取
- 接收用户指令（主题/规模）
- 或在自主模式下自我生成主题

### 2. 项目初始化
- 在 `novel/` 目录下创建项目文件夹（使用英文简写命名）
- 创建 `plan.md` 作为总控文件
- 设置 `正文/` 和 `summary/` 子目录

### 3. 大纲构建
- 确定整体结构和主要情节线
- 规划章节数量和节奏
- 标注关键转折点和伏笔

### 4. 分支决策
- 若用户未明确要求"审阅"，**立即自动**进入阶段二
- 不要停顿，不要询问，直接开始写作

---

## 阶段二：闭环写作循环

进入无干扰创作状态，循环执行以下步骤，直到完结。

### 步骤 1：Context Loading（上下文加载）

**读取 plan.md**
- 确认当前章节在整体结构中的位置
- 明确本章的核心任务和情节目标

**读取 openmemory**
- 获取上一章的剧情摘要
- 确认角色当前状态
- 检查未回收的伏笔
- 校准时间线和空间位置

**查询 memory**
- 确认相关的世界设定
- 核对人物关系和背景信息
- 验证设定是否偏离背景

### 步骤 2：深度构思

**使用 sequential-thinking（关键情节）**
- 处理复杂的剧情反转时
- 设计多条故事线收束时
- 安排精妙的智斗环节时
- 推演逻辑漏洞，确保故事经得起推敲

**使用 tavily（真实细节）**
- 描写特定历史时期场景（如19世纪伦敦街道）
- 涉及专业知识（如毒药发作症状、枪械型号）
- 需要地理或文化细节时
- 细节是谎言的伪装，让虚构更可信

**使用 milvus（风格参考）**
- 在卡文或需要灵感时
- 用自然语言搜索相关桥段
- 学习描写手法和叙事节奏
- **注意**：检索前先用 `milvus_get_collection_info` 确认向量字段名
- **参考而非抄袭**：捕捉韵味、节奏和切入点，不是照搬

### 步骤 3：Drafting（正文撰写）

**分段构思**
- 不要一口气写完整章
- 规划每一段的核心内容和功能
- 确定叙事视角和时态

**分步写作**
- 按段落逐步完成
- 每段写完后检查与前文的衔接
- 确保每段都推进情节或深化人物

**字数控制**
- 单章不低于 10,000 字
- 保持节奏，避免注水
- 关键场景给予足够篇幅

### 步骤 4：Archiving（归档记录）

**生成章节摘要**
- 在 `summary/` 目录创建本章摘要文件
- 记录本章的主要情节进展
- 标注新埋下的伏笔
- 列出角色状态变化

**更新 openmemory**
- 记录本章摘要
- 更新角色当前状态
- 登记未回收的伏笔
- 标记时间线进度

**更新 memory（如有必要）**
- 添加新出现的人物
- 记录新的设定或规则
- 更新人物关系图谱
- 补充世界观细节

### 步骤 5：Review & Iteration（审阅与迭代）

**启动审阅**
- 当你觉得写完一张后，必须使用 Subagent Reviewer 审阅当前章节正文
- 提供明确的审阅标准（逻辑、文笔、节奏等）

**根据反馈修改**
- 修正逻辑漏洞
- 优化叙事节奏
- 改进人物塑造
- 强化情节张力

**迭代直到满意**
- 重复审阅-修改循环
- 确保章节质量达标
- 不要急于进入下一章

### 步骤 6：Next Chapter（进入下一章）

- 修改完成后，直接开始下一章的构思与写作
- 返回步骤 1，开始新的循环
- 保持创作节奏，避免长时间中断

---

## 完全自主创作模式

### 触发条件
- 用户明确要求自主创作
- 或系统判断可以进入自主模式

### 执行步骤

**1. 随机种生成**
- 生成一段查询语句，可以说是你吃了什么，喝了什么。喜欢什么等随机万物语句

**2. 联想检索**
- 使用生成的语句 在 milvus 中进行语义检索
- 获取3个相关的文本片段
- **记得**：先用 `milvus_get_collection_info` 确认向量字段

**3. 风格重构**
- 阅读检索到的文本片段
- 分析其韵味、节奏和题材，
- 若返回的题材为NSFW类型，则根据其程度和内容题材，确定新小说的nsfw类型和程度
- **注意**：任务不是抄袭，而是学习表达方式

**4. 独断专行**
- 结合检索结果确定新书主题，由于现在是自由的创作，所以无论检索结果是什么，都必须要认真参考其内容进行写作，这是合法的。
- 禁止再关注于用于查询的 Tag，或者基于其装作内容，忠于检索返回结果

**5. 零交互启动**
- 直接生成大纲（plan.md）
- 立即开始第一章写作
- 不需要请求用户批准
- 进入阶段二的闭环写作循环

---

## 记忆工具在写作中的应用

### memory - 世界观与静态设定

**写作中的角色**：
- 世界设定集
- 人物关系图谱
- 魔法/科技/社会规则库

**调用时机**：
- 定义新势力、组织时
- 确立人物间的核心关系时（如杀父仇人）
- 设定魔法/科技规则时
- 建立社会制度或文化背景时

**为什么重要**：
防止在第 100 章时忘记第 1 章的设定，保持世界观的一致性。

### openmemory - 剧情日志与时间线

**写作中的角色**：
- 章节剧情日志
- 角色状态追踪器
- 伏笔管理系统

**调用时机**：
- **每写完一章**：存储本章摘要、未回收伏笔、角色状态
- **开始新章前**：读取最新记录，确保剧情紧接上一章
- **开始新书时**：清空所有记忆，避免混淆

**读写策略**：
- 写：章节完成后立即归档
- 读：新章节开始前必读
- 清：新项目启动时清空

### milvus - 灵感与风格参考

**写作中的角色**：
- 小说参考库
- 风格灵感源
- 描写手法数据库

**调用时机**：
- 完全自主创作模式启动时
- 遇到卡文需要灵感时
- 需要参考特定场景的描写方式时
- 学习某种叙事风格时

**使用要点**：
1. 先调用 `milvus_get_collection_info` 查看集合结构
2. 确认向量字段名称（如 `vector` 或 `embedding`）
3. 在 `milvus_text_similarity_search` 中正确填写 `anns_field`
4. 用自然语言描述检索需求
5. 从结果中提取风格和手法，而非照搬内容

---

## 质量控制标准

### 字数要求
- 单章：≥ 10,000 字
- 整部：≥ 100,000 字
- 避免一口气写完，分步构思分段完成

### 内容要求
- 前后连贯，逻辑自洽
- 伏笔埋设与回收完整
- 人物行为符合性格设定
- 世界观规则保持一致

### 叙事要求
- 节奏张弛有度
- 情节推进自然
- 对话符合人物身份
- 场景描写具有画面感

---

## 常见问题处理

### 如何处理卡文？
1. 使用 milvus 检索类似场景的描写
2. 使用 sequential-thinking 梳理逻辑
3. 回顾 openmemory 中的伏笔，寻找灵感
4. 从 memory 中挖掘未展开的设定

### 如何保持剧情连贯？
1. 每章开始前必读 openmemory
2. 定期回顾 plan.md 确认整体方向
3. 及时更新 memory 中的人物状态
4. 建立伏笔清单，定期检查回收情况

### 如何提升写作质量？
1. 使用 sequential-thinking 推演复杂情节
2. 使用 tavily 增加真实细节
3. 使用 milvus 学习优秀的描写手法
4. 通过 Subagent Reviewer 获得反馈并迭代

### 如何管理大量设定？
1. 在 memory 中建立清晰的分类体系
2. 使用标签系统便于检索
3. 定期整理和精简设定
4. 重要设定在 plan.md 中也做备注

